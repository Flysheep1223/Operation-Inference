## 📂 项目架构

本项目采用严格的模块化设计，将游戏引擎、敌人行为、战斗系统、物品系统和地图数据完全解耦。以下是各文件的详细设计说明：

### 🏗️ 核心引擎
**1. `main.pl` (启动入口)**
- **功能**: 程序的引导加载器。
- **设计**: 仅负责加载 `game_engine.pl` 和提供全局启动谓词 `play/0`，保持入口极其精简。

**2. `game_engine.pl` (游戏引擎)**
- **功能**: 游戏的中枢神经系统，集成战斗、物品、地图和渲染模块。
- **设计细节**:
  - **状态管理**: 维护玩家位置、HP、攻击力(ATK)、回合数(Turn)、敌人强化等级等动态谓词。
  - **输入循环**: 实时监听键盘输入 (WASD)，并将输入映射为游戏动作。
  - **物理与碰撞**: 处理移动请求，检测墙壁碰撞、边界限制。
  - **UI 渲染**: 在控制台绘制地图，顶部动态显示当前回合数和敌人强化等级。
  - **逻辑调度**: 在玩家每次行动后，依次触发物品检测、战斗判定和动态难度检查。

### ⚔️ 战斗与数值系统
**3. `combat_logic.pl` (战斗逻辑)**
- **功能**: 封装所有战斗判定与伤害结算逻辑。
- **机制**:
  - **8邻域检测**: 自动检测玩家周围 8 格内的敌人。
  - **数值对抗**: 
    - 若 `玩家ATK >= 敌人ATK`：敌人直接被消灭。
    - 若 `玩家ATK < 敌人ATK`：玩家扣除差值 HP，且敌人进入 **眩晕(Stun)** 状态。
  - **眩晕机制**: 战斗胜利的敌人会原地停止行动 2 个回合，给玩家逃跑机会。

**4. `scaling_manager.pl` (动态难度管理)**
- **功能**: 控制游戏随时间推移的难度增长。
- **机制**:
  - **回合计数**: 记录玩家的每一个有效操作。
  - **自动强化**: 每经过 **10 个回合**，地图上所有敌人的 ATK 自动增加 **10%**。
  - **等级系统**: 维护 `scaling_level`，直观展示敌人已被强化的次数。

### 🤖 敌人系统 (enemies/)
敌人系统被设计为插件式结构，由管理器统一调度。所有敌人现已支持攻击力(ATK)和眩晕(Stun)属性。

**5. `ai_manager.pl` (AI 总管)**
- **功能**: 统一调度 `init_enemies` 和 `enemies_tick`，负责分发所有敌人的初始化与行动指令。

**6. `ai_utils.pl` (AI 工具库)**
- **功能**: 提供通用的网格计算、碰撞检测和边界检查谓词。

**7. `bfs_chaser.pl` (智能追捕者 - 代号 'C')**
- **属性**: 初始 ATK 10。
- **行为**: 使用 BFS 算法寻找最短路径追击玩家。若处于眩晕状态则跳过行动。

**8. `random_walker.pl` (巡逻者 - 代号 'R')**
- **属性**: 初始 ATK 20。
- **行为**: 
  - **区域限制**: 初始生成 3 只，被严格限制在右下角墓地区域 (44,0) 至 (60,21) 内活动。
  - **随机游走**: 在限制区域内基于动量进行随机巡逻，不会主动离开该区域。
  - **眩晕**: 若处于眩晕状态则跳过行动。

**9. `hidden_bee.pl` (小Boss - 代号 'B')**
- **属性**: 初始 ATK 30，无法移动。
- **行为**: 
  - **周期攻击**: 每 5 回合向boss房中随机位置（同一横坐标）释放两列同步尖刺。
  - **尖刺机制**: 尖刺 (^) 每回合向右移动，触碰玩家造成 5 点伤害并消失。
  - **眩晕机制**: 若战斗失败会进入眩晕，暂停攻击倒计时。

**10. `timid_watched.pl` (中Boss - 代号 'T')**
- **属性**: 初始 ATK 20，随时间成长（每10回合增加10%）。
- **行为**: 
  - **区域游荡**: 在特定矩形区域内随机移动，不会主动追击。
  - **力量吞噬**: 玩家击败它后，会直接吸收其当前的 ATK 值叠加到玩家自身面板上。

### 🎒 物品与装备系统 (items/)
**11. `items/item_manager.pl` (物品管理器)**
- **功能**: 负责在游戏开始时随机生成物品，并处理玩家的拾取逻辑。

**12. `items/equipments/sword.pl` (铁剑 - 代号 'S')**
- **效果**: 拾取后玩家 ATK +10。

**13. `items/equipments/knife.pl` (匕首 - 代号 'K')**
- **效果**: 拾取后玩家 ATK +5。

**14. `items/tools/heathy_package.pl` (急救包 - 代号 'H')**
- **效果**: 一次性消耗品，拾取后立即回复 40 点生命值（上限 100）。

### 🗺️ 地图配置 (maps/)
**15. `level1.pl` (关卡配置)**
- **功能**: 纯数据文件，定义地图边界、墙壁布局、出生点和特殊区域。

## 🚀 快速运行

1. 启动 Prolog: swipl
2. 加载主文件: ['main.pl']
3. 开始游戏: play.

## 🎮 控制

- **W / A / S / D**: 上 / 左 / 下 / 右 移动。
- **Q**: 退出游戏。
- **tp(X, Y)**: (调试) 传送到坐标 (X, Y)。


