## 📂 项目架构

本项目采用严格的模块化设计，将游戏引擎、敌人行为、战斗系统、物品系统和地图数据完全解耦。以下是各文件的详细设计说明：

### 🏗️ 核心引擎
**1. `main.pl` (启动入口)**
- **功能**: 程序的引导加载器。
- **设计**: 仅负责加载 `game_engine.pl` 和提供全局启动谓词 `play/0`，保持入口极其精简。

**2. `game_engine.pl` (游戏引擎)**
- **功能**: 游戏的中枢神经系统，集成战斗、物品、地图和渲染模块。
- **设计细节**:
  - **状态管理**: 维护玩家位置、HP、攻击力(ATK)、分数(Score)、回合数(Turn)、敌人强化等级等动态谓词。
  - **输入循环**: 实时监听键盘输入 (WASD)，并将输入映射为游戏动作。
  - **物理与碰撞**: 处理移动请求，检测墙壁、边界、事件（如出口）的碰撞。
  - **UI 渲染**: 在控制台绘制地图，顶部动态显示当前HP、ATK、Score，并负责渲染各类符号（玩家@、敌人、宝藏、出口$等）。
  - **逻辑调度**: 在玩家每次行动后，依次触发物品检测、战斗判定、事件检查（如胜利条件）和动态难度检查。
  - **模块化调用**: 整合了 `check_exit` 逻辑，当玩家到达出口时触发结算。

### ⚔️ 战斗与数值系统
**3. `combat_logic.pl` (战斗逻辑)**
- **功能**: 封装所有战斗判定与伤害结算逻辑。
- **机制**:
  - **8邻域检测**: 自动检测玩家周围 8 格内的敌人。
  - **数值对抗**: 若 `玩家ATK >= 敌人ATK` 则消灭敌人；否则玩家扣除HP并眩晕敌人。
  - **眩晕机制**: 战斗胜利的敌人会原地停止行动 2 个回合。

**4. `scaling_manager.pl` (动态难度管理)**
- **功能**: 控制游戏随时间推移的难度增长。
- **机制**: 每经过 **10 个回合**，地图上所有敌人的 ATK 自动增加 **10%**。

### 🤖 敌人系统 (enemies/)
敌人系统被设计为插件式结构，由管理器统一调度。

**5. `ai_manager.pl` (AI 总管)**
- **功能**: 统一调度 `init_enemies` 和 `enemies_tick`，负责分发所有敌人的初始化与行动指令。

**6. `ai_utils.pl` (AI 工具库)**
- **功能**: 提供通用的网格计算、碰撞检测和边界检查谓词。

**7. `bfs_chaser.pl` (智能追捕者 - 代号 'C')**
- **行为**: 觉醒后使用 BFS 算法寻找最短路径追击玩家。

**8. `random_walker.pl` (巡逻者 - 代号 'R')**
- **行为**: 在限制区域内进行随机巡逻。

**9. `hidden_bee.pl` (原 static_boss.pl - 代号 'B')**
- **行为**: 周期性释放向右移动的尖刺 (^) 攻击玩家。

**10. `timid_watched.pl` (中Boss - 代号 'T')**
- **行为**: 区域游荡，被击败后玩家可吞噬其攻击力。

### 🎒 物品与装备系统 (items/)
**11. `items/item_manager.pl` (物品管理器)**
- **功能**: 负责在游戏开始时随机生成装备和宝藏，并处理玩家的拾取逻辑。
- **机制**: 
  - **装备生成**: 随机放置剑和匕首。
  - **宝藏生成**: 调用 `spawn_treasures` 随机放置钻石、黄金、白银。
  - **拾取逻辑**: 玩家重合时触发效果，装备增加ATK，宝藏增加Score。

**12. `items/equipments/sword.pl` (铁剑 - 代号 'S')**
- **效果**: 拾取后玩家 ATK +10。

**13. `items/equipments/knife.pl` (匕首 - 代号 'K')**
- **效果**: 拾取后玩家 ATK +5。

**14. `items/tools/heathy_package.pl` (急救包 - 代号 'H')**
- **效果**: 拾取后立即回复 40 点生命值。

**15. `items/treasures/diamond.pl` (钻石 - 代号 'O')**
- **效果**: 拾取后 Score +1000。

**16. `items/treasures/gold.pl` (黄金 - 代号 'G')**
- **效果**: 拾取后 Score +500。

**17. `items/treasures/silver.pl` (白银 - 代号 'V')**
- **效果**: 拾取后 Score +200。

### 🗺️ 地图配置 (maps/)
**18. `level1.pl` (关卡配置)**
- **功能**: 纯数据文件，定义地图边界、墙壁布局、出生点、出口位置和特殊区域。

## 🚀 快速运行

1. 启动 Prolog: swipl
2. 加载主文件: ['main.pl']
3. 开始游戏: play.

## 🎮 控制

- **W / A / S / D**: 上 / 左 / 下 / 右 移动。
- **Q**: 退出游戏。
- **tp(X, Y)**: (调试) 传送到坐标 (X, Y)。
