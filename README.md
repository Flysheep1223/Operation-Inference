## 📂 项目架构

本项目采用严格的模块化设计，将游戏引擎、敌人行为和地图数据完全解耦。以下是各文件的详细设计说明：

### 🏗️ 核心引擎
**1. `main.pl` (启动入口)**
- **功能**: 程序的引导加载器。
- **设计**: 仅负责加载 `game_engine.pl` 和提供全局启动谓词 `play/0`，保持入口极其精简。

**2. `game_engine.pl` (游戏引擎)**
- **功能**: 游戏的中枢神经系统，管理所有核心机制。
- **设计细节**:
  - **状态管理**: 维护玩家位置、生命值、游戏状态（进行中/结束）等动态谓词。
  - **输入循环**: 实时监听键盘输入 (WASD)，并将输入映射为游戏动作。
  - **物理与碰撞**: 处理移动请求，检测墙壁碰撞、边界限制以及与敌人的接触。
  - **地图加载器**: 包含通用的地图解析逻辑，能够动态加载不同的 `.pl` 关卡文件并生成墙壁数据。
  - **渲染系统**: 负责在控制台绘制当前地图状态、玩家位置和所有敌人的位置。

### 🤖 敌人系统 (enemies/)
敌人系统被设计为插件式结构，由管理器统一调度，方便扩展新的敌人类型。所有代码位于 `enemies/` 目录下。

**3. `ai_manager.pl` (AI 总管)**
- **功能**: 敌人系统的调度中心。
- **设计**:
  - 提供统一接口 `init_enemies/0` 初始化所有类型的敌人。
  - 提供统一接口 `enemies_tick/0`，在每回合触发所有敌人的行动逻辑。

**4. `ai_utils.pl` (AI 工具库)**
- **功能**: 为所有 AI 模块提供共享的辅助谓词，避免代码重复。
- **设计**:
  - `neighbor/2`: 计算网格中的相邻坐标。
  - `wall_check/1`: 统一的墙壁碰撞检测接口。
  - `in_bounds/2`: 统一的地图边界检测接口。

**5. `bfs_chaser.pl` (智能追捕者 - 代号 'C')**
- **功能**: 实现具有寻路能力的高智商敌人。
- **算法**: 实现了纯 Prolog 版本的 **BFS (广度优先搜索)** 算法。
- **行为**:
  - 每回合计算通往玩家的最短路径。
  - 能够智能绕过复杂的墙壁结构。
  - 对玩家构成主要的生存威胁。

**6. `random_walker.pl` (巡逻者 - 代号 'R')**
- **功能**: 实现模拟巡逻行为的普通敌人。
- **算法**: 基于 **动量 (Momentum)** 的随机游走算法。
- **行为**:
  - **惯性移动**: 有 80% 的概率保持当前移动方向，模拟有目的的巡逻。
  - **防抖动**: 遇到障碍或转向时，避免立即掉头，防止原地徘徊。
  - **随机性**: 增加游戏环境的不可预测性。

### 🗺️ 地图配置 (maps/)
**7. `level1.pl` (关卡配置)**
- **功能**: 纯数据文件，不包含任何逻辑代码。
- **设计**: 声明式地定义了地图的静态属性：
  - `map_size/2`: 地图边界。
  - `wall/2`: 具体的墙壁布局。
  - `spawn_pos/2` & `exit_pos/2`: 关键地点坐标。
  - `health_zone/4`: 特殊功能区域配置。

## 🚀 快速运行

1. 启动 Prolog: swipl
2. 加载主文件: ['main.pl']
3. 开始游戏: play.

## 🎮 控制

- **W / A / S / D**: 上 / 左 / 下 / 右 移动。
- **Q**: 退出游戏。
- **tp(X, Y)**: (调试) 传送到坐标 (X, Y)。


